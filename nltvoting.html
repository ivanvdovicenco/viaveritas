<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda Builder Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #f8fafc;
            --surface: #ffffff;
            --primary: #4f46e5; /* Indigo */
            --primary-hover: #4338ca;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --radius: 12px;
        }

        body { font-family: 'Nunito', sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; color: var(--text-dark); }
        .container { max-width: 1100px; margin: 0 auto; }
        .hidden { display: none !important; }

        /* --- CREATOR DASHBOARD STYLES --- */
        .dashboard-grid { display: grid; gap: 30px; }
        
        .panel {
            background: var(--surface); border-radius: 16px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 30px;
        }

        h1 { margin-top: 0; font-size: 24px; color: var(--text-dark); display: flex; align-items: center; gap: 10px; }
        h2 { font-size: 18px; color: var(--text-light); margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }

        /* FORM LAYOUT */
        .editor-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
        @media(max-width: 768px) { .editor-layout { grid-template-columns: 1fr; } }

        .form-group { margin-bottom: 20px; }
        label { display: block; font-size: 13px; font-weight: 700; color: var(--text-light); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        
        input, textarea {
            width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px;
            font-family: inherit; font-size: 15px; transition: 0.2s; box-sizing: border-box;
        }
        input:focus, textarea:focus { border-color: var(--primary); outline: none; }
        textarea { resize: vertical; min-height: 100px; }

        /* ICON GRID SELECTION */
        .icon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 10px; margin-top: 10px; }
        .icon-option {
            height: 50px; display: flex; align-items: center; justify-content: center;
            border: 2px solid var(--border); border-radius: 8px; cursor: pointer;
            font-size: 20px; color: var(--text-light); transition: 0.2s;
        }
        .icon-option:hover { background: #f1f5f9; }
        .icon-option.selected { border-color: var(--primary); background: #eef2ff; color: var(--primary); }

        .url-input-toggle { font-size: 12px; color: var(--primary); cursor: pointer; margin-top: 5px; text-decoration: underline; }

        /* ADD BUTTON */
        .btn-add-card {
            width: 100%; background: var(--text-dark); color: white; border: none;
            padding: 15px; border-radius: 10px; font-weight: 800; font-size: 16px;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: 0.2s;
        }
        .btn-add-card:hover { background: black; transform: translateY(-2px); }

        /* PREVIEW LIST */
        .preview-list { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        .preview-item {
            display: flex; align-items: center; gap: 15px; padding: 15px;
            background: #f8fafc; border: 1px solid var(--border); border-radius: 10px;
        }
        .preview-icon { width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary); border: 1px solid var(--border); }
        .preview-info { flex-grow: 1; }
        .preview-title { font-weight: 700; color: var(--text-dark); }
        .preview-time { font-size: 12px; color: var(--text-light); background: #e2e8f0; padding: 2px 6px; border-radius: 4px; }
        .btn-delete { color: #ef4444; background: none; border: none; cursor: pointer; font-size: 18px; padding: 5px; }

        /* FINAL CREATE ACTION */
        .create-section { margin-top: 40px; text-align: center; border-top: 2px dashed var(--border); padding-top: 40px;}
        .slug-input { font-size: 20px; font-weight: bold; text-align: center; max-width: 400px; margin: 0 auto 20px; display: block; }
        .btn-publish {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white; padding: 18px 40px; border-radius: 50px; border: none;
            font-size: 18px; font-weight: 800; cursor: pointer; box-shadow: 0 10px 25px rgba(79, 70, 229, 0.4);
            transition: 0.3s;
        }
        .btn-publish:hover { transform: scale(1.05); }

        /* --- VOTING VIEW STYLES (FROM PREVIOUS) --- */
        /* ... Keeping the clean flex styles ... */
        .cards-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; }
        .card-wrapper { flex: 1 1 300px; max-width: 380px; min-width: 280px; height: 480px; perspective: 1000px; cursor: pointer; }
        .card-wrapper.hidden-card { display: none; }
        .card-flipper { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        .card-wrapper.flipped .card-flipper { transform: rotateY(180deg); }
        .card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; background: white; display: flex; flex-direction: column; overflow: hidden; }
        .card-back { transform: rotateY(180deg); }
        
        .card-visual-header { padding: 30px 20px; text-align: center; color: white; flex-shrink: 0; position: relative; background-image: linear-gradient(to bottom right, rgba(255,255,255,0.15), rgba(0,0,0,0.05)); }
        .topic-icon { font-size: 50px; margin-bottom: 10px; }
        .custom-img-icon { height: 50px; width: auto; object-fit: contain; margin-bottom: 10px; filter: brightness(0) invert(1); }
        
        .card-title { font-size: 20px; font-weight: 800; margin: 0; line-height: 1.2; }
        .card-time { background: rgba(255,255,255,0.25); padding: 4px 12px; border-radius: 12px; font-size: 13px; font-weight: 700; display: inline-block; margin-top: 10px; }
        .card-body { flex-grow: 1; padding: 20px; overflow-y: auto; }
        .card-footer { padding: 20px; display: flex; justify-content: center; border-top: 1px solid #f0f0f0; }
        
        .vote-btn { background: #edf2f7; color: #64748b; border: none; padding: 10px 25px; border-radius: 50px; font-weight: 700; cursor: pointer; display: flex; gap: 10px; align-items: center; }
        .vote-btn.voted { background: #10b981; color: white; }
        .vote-count-badge { background: white; color: #333; padding: 2px 8px; border-radius: 10px; font-size: 12px; }
        
        /* Voting Header */
        header { background: white; padding: 15px 25px; border-radius: 16px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .header-btn { border:none; padding:8px 15px; border-radius:20px; font-weight:bold; cursor:pointer; margin-left:5px;}
    </style>
</head>
<body>

<div id="creatorView" class="container">
    <h1>üõ†Ô∏è –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ü–æ–≤–µ—Å—Ç–∫–∏</h1>
    
    <div class="dashboard-grid">
        
        <div class="panel">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É</h2>
            <div class="editor-layout">
                
                <div>
                    <div style="background:#eef2ff; color:#4f46e5; padding:5px 10px; border-radius:6px; display:inline-block; font-weight:bold; font-size:12px; margin-bottom:15px;">–°–¢–û–†–û–ù–ê 1 (–õ–∏—Ü–æ)</div>
                    
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞</label>
                        <input type="text" id="inpTitle" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë—é–¥–∂–µ—Ç 2024">
                    </div>

                    <div class="form-group">
                        <label>–í—Ä–µ–º—è (–º–∏–Ω—É—Ç—ã/—á–∞—Å—ã)</label>
                        <input type="text" id="inpTime" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15 –º–∏–Ω">
                    </div>

                    <div class="form-group">
                        <label>–ò–∫–æ–Ω–∫–∞ –∏–ª–∏ –†–∏—Å—É–Ω–æ–∫</label>
                        <input type="text" id="inpImgUrl" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="display:none; margin-bottom:10px;">
                        
                        <div class="icon-grid" id="iconSelector">
                            </div>
                        <div class="url-input-toggle" onclick="toggleUrlInput()">+ –í—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É (–ª–æ–≥–æ/—Ñ–ª–∞–≥)</div>
                    </div>
                </div>

                <div>
                    <div style="background:#f0fdf4; color:#15803d; padding:5px 10px; border-radius:6px; display:inline-block; font-weight:bold; font-size:12px; margin-bottom:15px;">–°–¢–û–†–û–ù–ê 2 (–û–±–æ—Ä–æ—Ç)</div>
                    
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞</label>
                        <textarea id="inpDesc" placeholder="–û —á–µ–º —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å? –ö–æ–Ω—Ç–µ–∫—Å—Ç..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</label>
                        <textarea id="inpExpect" placeholder="–ß–µ–≥–æ –º—ã —Ö–æ—Ç–∏–º –¥–æ—Å—Ç–∏—á—å? (–†–µ—à–µ–Ω–∏–µ, –ü–ª–∞–Ω, –ò–¥–µ–∏...)"></textarea>
                    </div>
                </div>
            </div>

            <button class="btn-add-card" onclick="addCardToList()">
                <i class="fa-solid fa-plus-circle"></i> –î–û–ë–ê–í–ò–¢–¨ –í –°–ü–ò–°–û–ö
            </button>
        </div>

        <div class="panel">
            <h2>–í–∞—à —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ (<span id="countDisplay">0</span>)</h2>
            <div id="previewList" class="preview-list">
                <div style="text-align:center; color:#94a3b8; padding:20px;">–°–ø–∏—Å–æ–∫ –ø–æ–∫–∞ –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–≤–µ—Ä—Ö—É.</div>
            </div>

            <div class="create-section">
                <label>–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É (ID –≤—Å—Ç—Ä–µ—á–∏)</label>
                <input type="text" id="meetingSlug" class="slug-input" placeholder="team-meeting-nov">
                <button class="btn-publish" onclick="publishMeeting()">–°–û–ó–î–ê–¢–¨ –í–°–¢–†–ï–ß–£ üöÄ</button>
            </div>
        </div>

    </div>
</div>

<div id="votingView" class="container hidden">
    <header>
        <div style="font-weight:800; font-size:20px; display:flex; gap:10px; align-items:center;">
            <i class="fa-solid fa-layer-group" style="color:var(--primary)"></i> 
            <span id="meetingTitleDisplay">Meeting</span>
        </div>
        <div>
            <button class="header-btn" style="background:#e0f2fe; color:#0284c7" onclick="shareLink()">üîó –°—Å—ã–ª–∫–∞</button>
            <button class="header-btn" style="background:#fef2f2; color:#ef4444" id="resetBtn">üóëÔ∏è –°–±—Ä–æ—Å</button>
        </div>
    </header>
    <div class="cards-container" id="cardsContainer"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, onValue, runTransaction, set, get } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    // --- CONFIG ---
    const firebaseConfig = {
      apiKey: "AIzaSyBZuH0pKTmfLbyz9lg1g0cC5S4MM16XpMk",
      authDomain: "cru-moldova-ivan.firebaseapp.com",
      databaseURL: "https://cru-moldova-ivan-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "cru-moldova-ivan",
      storageBucket: "cru-moldova-ivan.appspot.com",
      messagingSenderId: "913901012780",
      appId: "1:913901012780:web:aefc6983075e50e4000e89",
      measurementId: "G-2JYYSMTDER"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- STATE ---
    let tempAgenda = [];
    let selectedIcon = "fa-comments";
    const palette = ["#4f46e5", "#ea580c", "#059669", "#db2777", "#2563eb", "#7c3aed"];
    
    // --- ICONS LIST ---
    const icons = [
        "fa-comments", "fa-bullhorn", "fa-users", "fa-chart-pie", "fa-rocket", 
        "fa-hand-holding-dollar", "fa-earth-europe", "fa-lightbulb", "fa-handshake", 
        "fa-calendar-days", "fa-star", "fa-heart", "fa-bolt", "fa-book"
    ];

    // --- INIT CREATOR ---
    const urlParams = new URLSearchParams(window.location.search);
    const mId = urlParams.get('id');

    if (mId) {
        document.getElementById('creatorView').classList.add('hidden');
        document.getElementById('votingView').classList.remove('hidden');
        document.getElementById('meetingTitleDisplay').innerText = mId;
        initVoting(mId);
    } else {
        initIconGrid();
    }

    // --- CREATOR FUNCTIONS ---
    function initIconGrid() {
        const grid = document.getElementById('iconSelector');
        grid.innerHTML = '';
        icons.forEach(icon => {
            const div = document.createElement('div');
            div.className = `icon-option ${icon === selectedIcon ? 'selected' : ''}`;
            div.innerHTML = `<i class="fa-solid ${icon}"></i>`;
            div.onclick = () => selectIcon(div, icon);
            grid.appendChild(div);
        });
    }

    window.selectIcon = (el, iconClass) => {
        document.querySelectorAll('.icon-option').forEach(e => e.classList.remove('selected'));
        el.classList.add('selected');
        selectedIcon = iconClass;
        // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ URL –µ—Å–ª–∏ –≤—ã–±—Ä–∞–ª–∏ –∏–∫–æ–Ω–∫—É
        document.getElementById('inpImgUrl').value = '';
    }

    window.toggleUrlInput = () => {
        const input = document.getElementById('inpImgUrl');
        input.style.display = input.style.display === 'none' ? 'block' : 'none';
    }

    window.addCardToList = () => {
        const title = document.getElementById('inpTitle').value;
        const time = document.getElementById('inpTime').value;
        const desc = document.getElementById('inpDesc').value;
        const expect = document.getElementById('inpExpect').value;
        const customUrl = document.getElementById('inpImgUrl').value;

        if(!title) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞!");

        tempAgenda.push({
            id: Date.now(), // –≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è —Å–ø–∏—Å–∫–∞
            title,
            time: time || "15 –º–∏–Ω",
            desc,
            expect,
            icon: selectedIcon,
            customUrl: customUrl, // –ï—Å–ª–∏ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∞, –æ–Ω–∞ –ø–µ—Ä–µ–∫—Ä–æ–µ—Ç –∏–∫–æ–Ω–∫—É
            color: palette[tempAgenda.length % palette.length]
        });

        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('inpTitle').value = "";
        document.getElementById('inpTime').value = "";
        document.getElementById('inpDesc').value = "";
        document.getElementById('inpExpect').value = "";
        document.getElementById('inpImgUrl').value = "";
        
        renderPreview();
    };

    function renderPreview() {
        const list = document.getElementById('previewList');
        document.getElementById('countDisplay').innerText = tempAgenda.length;
        
        if(tempAgenda.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#94a3b8; padding:20px;">–°–ø–∏—Å–æ–∫ –ø–æ–∫–∞ –ø—É—Å—Ç.</div>';
            return;
        }

        list.innerHTML = '';
        tempAgenda.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'preview-item';
            
            let iconDisplay = `<i class="fa-solid ${item.icon}"></i>`;
            if(item.customUrl) iconDisplay = `<img src="${item.customUrl}" style="width:100%; height:100%; object-fit:cover; border-radius:50%;">`;

            div.innerHTML = `
                <div class="preview-icon">${iconDisplay}</div>
                <div class="preview-info">
                    <div class="preview-title">${item.title}</div>
                    <span class="preview-time">${item.time}</span>
                </div>
                <button class="btn-delete" onclick="removeCard(${index})"><i class="fa-solid fa-trash"></i></button>
            `;
            list.appendChild(div);
        });
    }

    window.removeCard = (index) => {
        tempAgenda.splice(index, 1);
        renderPreview();
    }

    window.publishMeeting = async () => {
        const slug = document.getElementById('meetingSlug').value.trim() || 'meeting-' + Math.floor(Math.random()*10000);
        
        if(tempAgenda.length === 0) return alert("–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–∞—Ä—Ç–æ—á–∫—É!");

        // –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º ID –¥–ª—è –ø–æ—Ä—è–¥–∫–∞
        const finalAgenda = tempAgenda.map((item, idx) => ({
            ...item,
            id: idx + 1
        }));

        await set(ref(db, `meetings/${slug}/agenda`), finalAgenda);
        window.location.href = `?id=${slug}`;
    }


    // --- VOTING FUNCTIONS (VIEW) ---
    async function initVoting(meetingId) {
        const agendaRef = ref(db, `meetings/${meetingId}/agenda`);
        const snapshot = await get(agendaRef);
        
        if (!snapshot.exists()) {
            document.getElementById('cardsContainer').innerHTML = '<h2>–í—Å—Ç—Ä–µ—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h2>';
            return;
        }

        const agendaData = snapshot.val();
        const container = document.getElementById('cardsContainer');
        const myVotes = JSON.parse(localStorage.getItem(`votes_${meetingId}`)) || {};

        agendaData.forEach(item => {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —à–∞–ø–∫–µ (–ò–∫–æ–Ω–∫—É –∏–ª–∏ –ö–∞—Ä—Ç–∏–Ω–∫—É)
            let visualHeaderContent = `<i class="topic-icon fa-solid ${item.icon}"></i>`;
            if (item.customUrl) {
                visualHeaderContent = `<img src="${item.customUrl}" class="custom-img-icon" alt="icon">`;
            }

            const isVoted = myVotes[item.id] ? 'voted' : '';
            const btnText = myVotes[item.id] ? '–ì–æ–ª–æ—Å –æ—Ç–¥–∞–Ω' : '–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å';
            const iconClass = myVotes[item.id] ? 'fa-solid fa-check' : 'fa-regular fa-thumbs-up';

            const html = `
             <div class="card-wrapper" id="card-${item.id}" onclick="this.classList.toggle('flipped')">
                <div class="card-flipper">
                    <div class="card-front">
                        <div class="card-visual-header" style="background: ${item.color}">
                            ${visualHeaderContent}
                            <h2 class="card-title">${item.title}</h2>
                            <span class="card-time">${item.time}</span>
                        </div>
                        <div class="card-body">
                             <div style="text-align:center; color:#cbd5e1; font-size:13px; margin-top:50px;">
                                <i class="fa-solid fa-rotate"></i> –ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å
                             </div>
                        </div>
                        <div class="card-footer">
                            <button class="vote-btn ${isVoted}" id="btn-${item.id}">
                                <i class="${iconClass}" id="icon-${item.id}"></i>
                                <span id="text-${item.id}">${btnText}</span>
                                <span class="vote-count-badge" id="count-${item.id}">0</span>
                            </button>
                        </div>
                    </div>
                    <div class="card-back">
                        <div class="card-body" style="border-top: 8px solid ${item.color}">
                            <h3 style="color:${item.color}">–û–ü–ò–°–ê–ù–ò–ï</h3>
                            <p>${(item.desc || '').replace(/\n/g, '<br>')}</p>
                            
                            <h3 style="color:${item.color}; margin-top:20px;">–û–ñ–ò–î–ê–ù–ò–Ø</h3>
                            <p>${(item.expect || '').replace(/\n/g, '<br>')}</p>
                        </div>
                    </div>
                </div>
             </div>
            `;
            container.insertAdjacentHTML('beforeend', html);

            // Logic
            setTimeout(() => {
                document.getElementById(`btn-${item.id}`).addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleVote(item.id, meetingId);
                });
            },0);
        });

        // Live Data
        onValue(ref(db, `meetings/${meetingId}/votes`), (snap) => {
            const votes = snap.val() || {};
            agendaData.forEach(item => {
                const count = votes[item.id] || 0;
                document.getElementById(`count-${item.id}`).innerText = count;
            });
        });

        // Reset
        document.getElementById('resetBtn').addEventListener('click', () => {
             if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –≥–æ–ª–æ—Å–∞?")) { 
                 set(ref(db, `meetings/${meetingId}/votes`), {}); 
                 localStorage.removeItem(`votes_${meetingId}`); 
                 location.reload(); 
             }
        });
        window.shareLink = () => { navigator.clipboard.writeText(window.location.href); alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!"); };
    }

    function toggleVote(itemId, mId) {
        const myVotes = JSON.parse(localStorage.getItem(`votes_${mId}`)) || {};
        const itemRef = ref(db, `meetings/${mId}/votes/${itemId}`);
        const btn = document.getElementById(`btn-${itemId}`);
        const icon = document.getElementById(`icon-${itemId}`);
        const text = document.getElementById(`text-${itemId}`);

        if (myVotes[itemId]) {
            runTransaction(itemRef, (c) => (c || 0) > 0 ? c - 1 : 0);
            delete myVotes[itemId];
            btn.classList.remove('voted');
            icon.className = 'fa-regular fa-thumbs-up';
            text.innerText = '–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å';
        } else {
            runTransaction(itemRef, (c) => (c || 0) + 1);
            myVotes[itemId] = true;
            btn.classList.add('voted');
            icon.className = 'fa-solid fa-check';
            text.innerText = '–ì–æ–ª–æ—Å –æ—Ç–¥–∞–Ω';
        }
        localStorage.setItem(`votes_${mId}`, JSON.stringify(myVotes));
    }

</script>
</body>
</html>











